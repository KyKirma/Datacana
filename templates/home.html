{% extends 'default.html' %}

{% block conteudo %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <!-- Plug-in Odometro -->
    <link rel="stylesheet" href="http://github.hubspot.com/odometer/themes/odometer-theme-minimal.css" />
    <script src="http://github.hubspot.com/odometer/odometer.js"></script>
    <script>
        setTimeout(function(){
            odometer.innerHTML = "{{ AreaMG }}";
        }, 1);
    </script>

    <div id="cover">
        <div id="title">
            <h2>Projeto DataCana</h2>
            <div class="container" id="rule"></div>
        </div>
    </div>
        
    <div class="content">
        <div class="row">
            <div class="col text-center" style="max-width: 50%;">
                <div class="mx-5" >
                    <div class="p-2" style="border-radius: 20px 20px 0 0; border: 1px solid #424242;">
                        <h3 style="margin: 0;">Minas Gerais</h3>
                    </div>
                    <div style="background-color: #CDE4AE;">
                        <h1 id="odometer" class="odometer"></h1>
                    </div>
                    <div>
                        <p>texto foda aqui gu</p>
                        <button>acessar a plat</button>
                    </div>
                </div>
            </div>
            <div class="col text-center" style="max-width: 50%;">
                <div id="map" style="width: 510px; height: 510px;"></div>
            </div>
        </div>
    </div>

    <!-- Plug-in Responsive Pop-up -->
    <script src="https://unpkg.com/leaflet-responsive-popup@1.0.0/leaflet.responsive.popup.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-responsive-popup@1.0.0/leaflet.responsive.popup.css"/>

    <!-- Plug-in MapTiler -->
    <script src="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.0/leaflet.umd.js"></script>
    <link href="https://cdn.maptiler.com/maptiler-geocoding-control/v1.2.0/style.css" rel="stylesheet">

    <script>
                // Função GET Dados
        async function getDados() {
            try {
                const response = await fetch('/map/Data');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erro ao buscar dados:', error);
            }
        }

        $(document).ready(function () {
            getDados()
                .then(function (response) {
                    var map = L.map('map', {
                        zoomControl: false
                    });

                    var estilos =   { 
                        uf: {
                            color: '#dddddd',
                            weight: 1,
                            fillOpacity:1,
                            fillColor: '#FDF5E6'
                        }
                    }

                    function getRadius(areaHa) {
                        // Define a escala de raio
                        const scale = 0.1;

                        // Calcula o raio com base na área em hectares
                        const radius = (Math.sqrt(areaHa) * scale) / 2;

                        // Retorna o raio com um valor mínimo de 2 pixels
                        return Math.max(radius, 2);
                    }

                    jQuery.getJSON("https://servicodados.ibge.gov.br/api/v2/malhas/31?formato=application/vnd.geo+json", function(JSON){
                        var layer = new L.geoJSON(JSON, estilos.uf);   
                        var ufExtent = layer.getBounds();
                        map.fitBounds(ufExtent, {animate: false});
                        map.setZoom(6)
                        layer.addTo(map);

                        for (let i = 0; i < response.qnt; i++) {
                        const municipio = response.data['MUNICIPIO'][i];
                        const areaHa = response.data['AREA_HA'][i];
                        const radius = getRadius(areaHa);

                        let marker = L.circleMarker([response.data['LAT'][i], response.data['LONG'][i]], {
                            color: 'darkgreen',
                            radius: radius,
                            stroke: true,
                            weight: 0.8,
                            opacity: 1,
                        });

                        marker.addTo(layer);
                        }
                    });                   
                    
                        map.dragging.disable();
                        map.touchZoom.disable();
                        map.doubleClickZoom.disable();
                        map.scrollWheelZoom.disable();
                        map.boxZoom.disable();
                        map.keyboard.disable();
            
                })
                .catch(function (error) {
                    console.error("Error fetching data:", error);
                });
        });
    </script>
{% endblock %}

{% block estilo %}
    <style>
        /* CAPA */

        main > div#cover {
            display: flex;
            background-image: url('../static/images/Capa.jpg');
            background-size: cover;
            align-items: center;
            justify-content: center;
        }

        main > div#cover > div#title > h2 {
            color: #FFFFFF;
            text-align: center;
            font-weight: bold;

            animation: fadeInDown;
            animation-duration: 0.75s;
        }

        main > div#cover > div#title > div#rule {
            border-bottom: 3px solid #FFFFFF;

            animation: zoomIn;
            animation-duration: 0.75s;
        }

        main > div#cover > div#title > div.container {
            max-width: 75%;
        }

        /* CONTEÚDO */

        main > div.content {
            background-color: #FFFFFF;
            margin: 25px 0px;
            padding: 40px;
        }

        /* MEDIA-QUERY PARA DISPOSITIVOS */

        /* DISPOSITIVOS GRANDES */

        @media screen and (min-width: 768px) {
            main > div#cover {
                background-position: center;
                height: 65vh;
            }

            main > div#cover > div#title > h2 {
                font-size: 42px;
            }
        }

        /* DISPOSITIVOS PEQUENOS */

        @media screen and (max-width: 768px) {
            main > div#cover {
                background-position: right bottom;
                height: 42vh;
            }

            main > div#cover > div#title > h2 {
                font-size: 35px;
            }
        }
    </style>
{% endblock %}